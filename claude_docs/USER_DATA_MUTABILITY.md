# ç”¨æˆ·æ•°æ®å¯å˜æ€§åˆ†æ

æœ¬æ–‡æ¡£åˆ†æ gym-buddy ç³»ç»Ÿä¸­ç”¨æˆ·æ•°æ®çš„å¯å˜æ€§ï¼ˆMutabilityï¼‰ï¼ŒåŒºåˆ†å“ªäº›æ•°æ®æ˜¯å¯å˜çš„ï¼ˆåº”è¯¥å®šæœŸæ›´æ–°ï¼‰ï¼Œå“ªäº›æ˜¯ä¸å¯å˜çš„ï¼ˆå‡ ä¹ä¸ä¼šæ”¹å˜ï¼‰ã€‚

## æ•°æ®åˆ†ç±»

### ğŸ”’ ä¸å¯å˜æ•°æ®ï¼ˆImmutable Dataï¼‰

è¿™äº›æ•°æ®ä¸€æ—¦è®¾ç½®åï¼Œå‡ ä¹ä¸ä¼šæ”¹å˜æˆ–æ”¹å˜é¢‘ç‡æä½ã€‚

#### 1. æ€§åˆ« (Gender)
- **å­—æ®µ**: `gender`
- **ç±»å‹**: `'male' | 'female' | 'other'`
- **å¯å˜æ€§**: âŒ **ä¸å¯å˜**
- **åŸå› **:
  - ç”¨äºä»£è°¢ç‡è®¡ç®—çš„ç”Ÿç†æ€§åˆ«é€šå¸¸ä¸å˜
  - å¦‚æœç”¨æˆ·éœ€è¦ä¿®æ”¹ï¼Œåº”è¯¥æ˜¯æå°‘æ•°æƒ…å†µ
- **å»ºè®®**:
  - å…è®¸ä¿®æ”¹ï¼Œä½†éœ€è¦ç¡®è®¤æç¤º
  - ä¿®æ”¹åé‡æ–°è®¡ç®—æ‰€æœ‰åŸºäºæ€§åˆ«çš„æŒ‡æ ‡

#### 2. å‡ºç”Ÿæ—¥æœŸ (Date of Birth)
- **å­—æ®µ**: `dateOfBirth`
- **ç±»å‹**: `Date`
- **å¯å˜æ€§**: âŒ **ä¸å¯å˜**
- **åŸå› **:
  - ç”Ÿç†å¹´é¾„ä¸ä¼šæ”¹å˜ï¼ˆåªä¼šéšæ—¶é—´è‡ªåŠ¨å¢é•¿ï¼‰
  - ç”¨äºè®¡ç®—å®é™…å¹´é¾„
- **å»ºè®®**:
  - åªå…è®¸åœ¨åˆæ¬¡è®¾ç½®æ—¶å¡«å†™
  - å¦‚å‘ç°é”™è¯¯å¯ä¿®æ”¹ï¼Œä½†éœ€è¦ç®¡ç†å‘˜æƒé™æˆ–éªŒè¯
  - **ä¼˜åŒ–å»ºè®®**: å­˜å‚¨ `dateOfBirth` è€Œä¸æ˜¯ `age`ï¼Œç³»ç»Ÿè‡ªåŠ¨è®¡ç®—å¹´é¾„

#### 3. èº«é«˜ (Height)
- **å­—æ®µ**: `fitnessProfile.height`
- **ç±»å‹**: `number` (cm)
- **å¯å˜æ€§**: âš ï¸ **å‡ ä¹ä¸å¯å˜**
- **åŸå› **:
  - æˆå¹´åèº«é«˜åŸºæœ¬ä¸å˜
  - åªåœ¨é’å°‘å¹´é˜¶æ®µæˆ–ç‰¹æ®Šæƒ…å†µä¸‹ä¼šæ”¹å˜
- **æ›´æ–°é¢‘ç‡**:
  - æˆå¹´äººï¼šå‡ ä¹ä¸éœ€è¦æ›´æ–°
  - é’å°‘å¹´ï¼ˆ< 18å²ï¼‰ï¼šæ¯ 6-12 ä¸ªæœˆæµ‹é‡æ›´æ–°
- **å»ºè®®**:
  - å…è®¸ä¿®æ”¹ï¼Œä½†ä¸å¼ºåˆ¶å®šæœŸæ›´æ–°
  - å¯¹ 18 å²ä»¥ä¸‹ç”¨æˆ·å¯æç¤ºå®šæœŸæ›´æ–°

---

### ğŸ”„ å¯å˜æ•°æ® - æ…¢å˜åŒ–ï¼ˆSlowly Changing Dataï¼‰

è¿™äº›æ•°æ®ä¼šæ”¹å˜ï¼Œä½†å˜åŒ–ç¼“æ…¢ï¼Œæ›´æ–°é¢‘ç‡ä¸ºæœˆ/å­£åº¦çº§åˆ«ã€‚

#### 4. è®­ç»ƒæ°´å¹³ (Training Level)
- **å­—æ®µ**: `fitnessProfile.trainingLevel`
- **ç±»å‹**: `'beginner' | 'intermediate' | 'advanced' | 'elite'`
- **å¯å˜æ€§**: âœ… **å¯å˜ï¼ˆæ…¢ï¼‰**
- **å˜åŒ–å‘¨æœŸ**: 3-6 ä¸ªæœˆ
- **åŸå› **:
  - è®­ç»ƒç»éªŒéšæ—¶é—´ç§¯ç´¯
  - beginner â†’ intermediateï¼ˆ6ä¸ªæœˆ-1å¹´ï¼‰
  - intermediate â†’ advancedï¼ˆ1-3å¹´ï¼‰
  - advanced â†’ eliteï¼ˆ2-5å¹´ï¼‰
- **æ›´æ–°å»ºè®®**:
  - æ¯ 3-6 ä¸ªæœˆæé†’ç”¨æˆ·å®¡æŸ¥
  - åŸºäº 1RM è¿›æ­¥è‡ªåŠ¨å»ºè®®å‡çº§
  - ç»“åˆè®­ç»ƒå¹´é™è‡ªåŠ¨æ¨æ–­

#### 5. æ´»åŠ¨æ°´å¹³ (Activity Level)
- **å­—æ®µ**: `fitnessProfile.activityLevel`
- **ç±»å‹**: `'sedentary' | 'lightlyActive' | 'moderatelyActive' | 'veryActive' | 'extraActive'`
- **å¯å˜æ€§**: âœ… **å¯å˜ï¼ˆä¸­ç­‰ï¼‰**
- **å˜åŒ–å‘¨æœŸ**: 1-3 ä¸ªæœˆ
- **åŸå› **:
  - ç”Ÿæ´»æ–¹å¼ã€å·¥ä½œæ€§è´¨å¯èƒ½æ”¹å˜
  - è®­ç»ƒé¢‘ç‡å¢åŠ /å‡å°‘
- **æ›´æ–°å»ºè®®**:
  - æ¯æœˆæé†’ç”¨æˆ·å®¡æŸ¥
  - é‡æ–°è®¡ç®— TDEEï¼ˆæ€»æ—¥å¸¸èƒ½é‡æ¶ˆè€—ï¼‰
  - å½±å“è¥å…»å»ºè®®å’Œå¡è·¯é‡Œæ‘„å…¥

#### 6. è®­ç»ƒå¹´é™ (Training Years)
- **å­—æ®µ**: `fitnessProfile.trainingYears`
- **ç±»å‹**: `number`
- **å¯å˜æ€§**: âœ… **å¯å˜ï¼ˆçº¿æ€§å¢é•¿ï¼‰**
- **å˜åŒ–å‘¨æœŸ**: æŒç»­å¢é•¿
- **åŸå› **:
  - éšæ—¶é—´çº¿æ€§å¢åŠ 
  - å¯èƒ½å› ä¸­æ–­è®­ç»ƒè€Œåœæ»æˆ–å‡å°‘
- **æ›´æ–°å»ºè®®**:
  - æ¯ 6-12 ä¸ªæœˆæ›´æ–°
  - æˆ–è€…åŸºäºé¦–æ¬¡è®­ç»ƒæ—¥æœŸè‡ªåŠ¨è®¡ç®—

---

### ğŸ“Š å¯å˜æ•°æ® - å¿«å˜åŒ–ï¼ˆFrequently Changing Dataï¼‰

è¿™äº›æ•°æ®ä¼šé¢‘ç¹å˜åŒ–ï¼Œéœ€è¦å®šæœŸè·Ÿè¸ªå’Œæ›´æ–°ã€‚

#### 7. ä½“é‡ (Weight)
- **å­—æ®µ**: `fitnessProfile.weight`
- **ç±»å‹**: `number` (kg)
- **å¯å˜æ€§**: âœ… **é«˜åº¦å¯å˜**
- **å˜åŒ–å‘¨æœŸ**: æ¯å‘¨/æ¯æ—¥
- **åŸå› **:
  - å‡è„‚/å¢è‚Œè®­ç»ƒä¼šæ”¹å˜ä½“é‡
  - é¥®é£Ÿã€æ°´åˆ†æ‘„å…¥å½±å“ä½“é‡
  - æ˜¯æœ€é‡è¦çš„è¿›åº¦è¿½è¸ªæŒ‡æ ‡
- **æ›´æ–°å»ºè®®**:
  - **æ¯å‘¨æµ‹é‡å¹¶è®°å½•**ï¼ˆæ¨èï¼šå‘¨ä¸€æ—©æ™¨ç©ºè…¹ï¼‰
  - ä¿å­˜å†å²è®°å½•ç”¨äºè¶‹åŠ¿åˆ†æ
  - ä½¿ç”¨ä½“é‡æ›²çº¿è€Œä¸æ˜¯å•æ¬¡æ•°å€¼
- **æ•°æ®æ¨¡å‹å»ºè®®**:
  ```typescript
  // å½“å‰ä½“é‡
  currentWeight: number;

  // ä½“é‡å†å²è®°å½•ï¼ˆå•ç‹¬è¡¨ï¼‰
  weightHistory: [
    { weight: 70.5, measuredAt: Date, notes: string }
  ]
  ```

#### 8. ä½“è„‚ç‡ (Body Fat Percentage)
- **å­—æ®µ**: `fitnessProfile.bodyFatPercentage`
- **ç±»å‹**: `number` (%)
- **å¯å˜æ€§**: âœ… **å¯å˜ï¼ˆä¸­ç­‰ï¼‰**
- **å˜åŒ–å‘¨æœŸ**: æ¯æœˆ
- **åŸå› **:
  - å‡è„‚/å¢è‚Œè®­ç»ƒä¼šæ”¹å˜ä½“è„‚ç‡
  - å˜åŒ–æ…¢äºä½“é‡ï¼ˆæ›´ç¨³å®šçš„æŒ‡æ ‡ï¼‰
- **æ›´æ–°å»ºè®®**:
  - **æ¯æœˆæµ‹é‡å¹¶è®°å½•**ï¼ˆåŒä¸€æµ‹é‡æ–¹æ³•ä¿æŒä¸€è‡´æ€§ï¼‰
  - ä¸å»ºè®®æ¯å‘¨æµ‹é‡ï¼ˆæµ‹é‡è¯¯å·®å¯èƒ½å¤§äºå®é™…å˜åŒ–ï¼‰
  - ä¿å­˜å†å²è®°å½•
- **æ³¨æ„**:
  - æµ‹é‡æ–¹æ³•ä¸€è‡´æ€§å¾ˆé‡è¦ï¼ˆBIA/çš®è¤¶/DEXAï¼‰
  - ä¸åŒæ–¹æ³•ç»“æœä¸å¯ç›´æ¥æ¯”è¾ƒ

#### 9. ç˜¦ä½“é‡ (Lean Body Mass)
- **å­—æ®µ**: `fitnessProfile.leanBodyMass`
- **ç±»å‹**: `number` (kg)
- **å¯å˜æ€§**: âœ… **å¯å˜ï¼ˆä¸­ç­‰ï¼‰**
- **å˜åŒ–å‘¨æœŸ**: æ¯æœˆï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
- **åŸå› **:
  - åŸºäºä½“é‡å’Œä½“è„‚ç‡è®¡ç®—
  - å¢è‚Œè®­ç»ƒä¼šå¢åŠ  LBM
- **è®¡ç®—å…¬å¼**:
  ```typescript
  LBM = weight - (weight Ã— bodyFatPercentage / 100)
  ```
- **æ›´æ–°å»ºè®®**:
  - **ä¸éœ€è¦æ‰‹åŠ¨è¾“å…¥**ï¼Œåº”è¯¥è‡ªåŠ¨è®¡ç®—
  - ä½“é‡æˆ–ä½“è„‚ç‡æ›´æ–°æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—
  - ä¿å­˜å†å²è®°å½•

#### 10. å¹´é¾„ (Age)
- **å­—æ®µ**: `fitnessProfile.age`
- **ç±»å‹**: `number`
- **å¯å˜æ€§**: âœ… **å¯å˜ï¼ˆè‡ªåŠ¨ï¼‰**
- **å˜åŒ–å‘¨æœŸ**: æ¯å¹´ï¼ˆç”Ÿæ—¥ï¼‰
- **åŸå› **:
  - éšæ—¶é—´è‡ªç„¶å¢é•¿
  - å½±å“ BMR è®¡ç®—
- **ä¼˜åŒ–å»ºè®®**:
  - âš ï¸ **ä¸åº”è¯¥å­˜å‚¨ `age`ï¼Œåº”è¯¥å­˜å‚¨ `dateOfBirth`**
  - ç³»ç»Ÿæ ¹æ®å½“å‰æ—¥æœŸè‡ªåŠ¨è®¡ç®—å¹´é¾„
  - é¿å…æ•°æ®è¿‡æœŸé—®é¢˜
  ```typescript
  // âŒ ä¸æ¨è
  age: 25  // ä¸€å¹´åè¿‡æœŸ

  // âœ… æ¨è
  dateOfBirth: Date('2000-01-15')
  // è®¡ç®—å¹´é¾„ï¼š
  const age = new Date().getFullYear() - new Date(dateOfBirth).getFullYear();
  ```

---

## æ•°æ®æ›´æ–°é¢‘ç‡æ€»ç»“è¡¨

| å­—æ®µ | å¯å˜æ€§ | æ›´æ–°é¢‘ç‡ | æ¨èæ“ä½œ | æ˜¯å¦éœ€è¦å†å²è®°å½• |
|------|-------|---------|---------|---------------|
| **gender** | âŒ ä¸å¯å˜ | å‡ ä¹ä¸éœ€è¦ | å…è®¸ä¿®æ”¹ä½†éœ€ç¡®è®¤ | âŒ å¦ |
| **dateOfBirth** | âŒ ä¸å¯å˜ | ä»…åˆæ¬¡è®¾ç½® | åˆæ¬¡è®¾ç½®åé”å®š | âŒ å¦ |
| **height** | âš ï¸ å‡ ä¹ä¸å¯å˜ | é’å°‘å¹´ï¼š6-12ä¸ªæœˆ<br>æˆå¹´äººï¼šå‡ ä¹ä¸éœ€è¦ | å…è®¸ä¿®æ”¹ | âŒ å¦ï¼ˆæˆå¹´äººï¼‰<br>âœ… æ˜¯ï¼ˆé’å°‘å¹´ï¼‰ |
| **weight** | âœ… é«˜åº¦å¯å˜ | **æ¯å‘¨** | å®šæœŸæé†’æµ‹é‡ | âœ… **æ˜¯** |
| **bodyFatPercentage** | âœ… å¯å˜ | **æ¯æœˆ** | å®šæœŸæé†’æµ‹é‡ | âœ… **æ˜¯** |
| **leanBodyMass** | âœ… å¯å˜ | è‡ªåŠ¨è®¡ç®— | ä½“é‡/ä½“è„‚æ›´æ–°æ—¶é‡ç®— | âœ… **æ˜¯** |
| **age** | âœ… è‡ªåŠ¨å¯å˜ | æ¯å¹´ï¼ˆè‡ªåŠ¨ï¼‰ | ä» dateOfBirth è®¡ç®— | âŒ å¦ |
| **trainingLevel** | âœ… å¯å˜ï¼ˆæ…¢ï¼‰ | 3-6 ä¸ªæœˆ | æé†’å®¡æŸ¥ + è‡ªåŠ¨å»ºè®® | âœ… æ˜¯ï¼ˆç”¨äºåˆ†æï¼‰ |
| **activityLevel** | âœ… å¯å˜ï¼ˆä¸­ï¼‰ | 1-3 ä¸ªæœˆ | æé†’å®¡æŸ¥ | âœ… æ˜¯ï¼ˆç”¨äºåˆ†æï¼‰ |
| **trainingYears** | âœ… å¯å˜ï¼ˆçº¿æ€§ï¼‰ | 6-12 ä¸ªæœˆ | ä»é¦–æ¬¡è®­ç»ƒæ—¥æœŸè®¡ç®— | âŒ å¦ |

---

## æ¨èçš„æ•°æ®æ¨¡å‹ä¼˜åŒ–

### å½“å‰å®ç°é—®é¢˜

```typescript
// âŒ å½“å‰å®ç°
fitnessProfile: {
  weight: number;              // å•ä¸€æ•°å€¼ï¼Œæ— æ³•è¿½è¸ªå†å²
  height: number;
  age: number;                 // ä¼šè¿‡æœŸï¼åº”è¯¥ç”¨ dateOfBirth
  bodyFatPercentage: number;   // å•ä¸€æ•°å€¼ï¼Œæ— æ³•è¿½è¸ªå†å²
  leanBodyMass: number;        // å•ä¸€æ•°å€¼ï¼Œæ— æ³•è¿½è¸ªå†å²
  // ...
}
```

### æ¨èçš„ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆ 1: åˆ†ç¦»é™æ€å’ŒåŠ¨æ€æ•°æ®

```typescript
// ç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼ˆå‡ ä¹ä¸å˜ï¼‰
interface UserProfile {
  gender: 'male' | 'female' | 'other';
  dateOfBirth: Date;           // âœ… å­˜å‚¨å‡ºç”Ÿæ—¥æœŸï¼Œä¸å­˜å‚¨å¹´é¾„
  height: number;              // æˆå¹´äººå‡ ä¹ä¸å˜

  // è®­ç»ƒåå¥½ï¼ˆæ…¢å˜åŒ–ï¼‰
  trainingLevel: 'beginner' | 'intermediate' | 'advanced' | 'elite';
  activityLevel: 'sedentary' | 'lightlyActive' | 'moderatelyActive' | 'veryActive' | 'extraActive';

  // å…ƒæ•°æ®
  firstTrainingDate?: Date;    // âœ… ç”¨äºè‡ªåŠ¨è®¡ç®— trainingYears
}

// èº«ä½“æˆåˆ†æ•°æ®ï¼ˆå¿«å˜åŒ–ï¼Œéœ€è¦å†å²è®°å½•ï¼‰
interface BodyComposition {
  userId: ObjectId;
  weight: number;
  bodyFatPercentage?: number;
  leanBodyMass?: number;       // è‡ªåŠ¨è®¡ç®—
  measuredAt: Date;
  measurementMethod?: 'scale' | 'BIA' | 'DEXA' | 'skinfold';
  notes?: string;
}

// ç”¨æˆ·å½“å‰çŠ¶æ€ï¼ˆè™šæ‹Ÿå­—æ®µ/è®¡ç®—å­—æ®µï¼‰
interface UserCurrentState {
  currentWeight: number;         // ä» BodyComposition æœ€æ–°è®°å½•è·å–
  currentBodyFat: number;        // ä» BodyComposition æœ€æ–°è®°å½•è·å–
  currentAge: number;            // ä» dateOfBirth è®¡ç®—
  currentTrainingYears: number;  // ä» firstTrainingDate è®¡ç®—
}
```

#### æ–¹æ¡ˆ 2: ä½¿ç”¨åµŒå…¥å¼å†å²æ•°ç»„ï¼ˆMongoDBï¼‰

```typescript
interface User {
  // é™æ€ä¿¡æ¯
  gender: 'male' | 'female' | 'other';
  dateOfBirth: Date;

  // åŠ¨æ€ä¿¡æ¯ - å½“å‰å€¼
  currentProfile: {
    height: number;
    weight: number;
    bodyFatPercentage?: number;
    trainingLevel: string;
    activityLevel: string;
    updatedAt: Date;
  };

  // åŠ¨æ€ä¿¡æ¯ - å†å²è®°å½•ï¼ˆæœ€è¿‘ 100 æ¡ï¼‰
  weightHistory: Array<{
    weight: number;
    measuredAt: Date;
  }>;

  bodyCompositionHistory: Array<{
    bodyFatPercentage: number;
    leanBodyMass: number;
    measuredAt: Date;
    method: string;
  }>;

  // è®­ç»ƒä¿¡æ¯
  firstTrainingDate?: Date;
}

// è™šæ‹Ÿå­—æ®µï¼ˆgetterï¼‰
userSchema.virtual('age').get(function() {
  const today = new Date();
  const birthDate = new Date(this.dateOfBirth);
  return today.getFullYear() - birthDate.getFullYear();
});

userSchema.virtual('trainingYears').get(function() {
  if (!this.firstTrainingDate) return 0;
  const today = new Date();
  const startDate = new Date(this.firstTrainingDate);
  return (today - startDate) / (365.25 * 24 * 60 * 60 * 1000);
});
```

---

## å®ç°å»ºè®®

### Phase 1: ç«‹å³ä¼˜åŒ–ï¼ˆå‘åå…¼å®¹ï¼‰

1. **ä¿®å¤ age å­—æ®µ**
   - æ·»åŠ  `dateOfBirth` åˆ° User æ¨¡å‹
   - ä¿ç•™ `fitnessProfile.age` ä½†æ ‡è®°ä¸º deprecated
   - åˆ›å»ºè™šæ‹Ÿå­—æ®µè‡ªåŠ¨è®¡ç®—å¹´é¾„

   ```typescript
   // lib/models/User.ts
   UserSchema.virtual('calculatedAge').get(function() {
     if (!this.dateOfBirth) return this.fitnessProfile?.age || 0;
     const today = new Date();
     const birthDate = new Date(this.dateOfBirth);
     let age = today.getFullYear() - birthDate.getFullYear();
     const monthDiff = today.getMonth() - birthDate.getMonth();
     if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
       age--;
     }
     return age;
   });
   ```

2. **æ·»åŠ  firstTrainingDate**
   - åœ¨ onboarding æ—¶è¯¢é—®"ä½•æ—¶å¼€å§‹è®­ç»ƒ"
   - ç”¨äºè‡ªåŠ¨è®¡ç®— `trainingYears`

3. **åˆ›å»º weight_history é›†åˆ**
   - æ–°å»ºç‹¬ç«‹çš„ MongoDB é›†åˆå­˜å‚¨ä½“é‡å†å²
   - ä¿ç•™ `fitnessProfile.weight` ä½œä¸ºå¿«é€Ÿè®¿é—®çš„å½“å‰å€¼

   ```typescript
   // models/WeightHistory.ts
   interface WeightHistoryRecord {
     userId: ObjectId;
     weight: number;
     measuredAt: Date;
     notes?: string;
   }
   ```

### Phase 2: åŠŸèƒ½å¢å¼º

1. **è‡ªåŠ¨æé†’ç³»ç»Ÿ**
   - æ¯å‘¨ä¸€æé†’ç”¨æˆ·è®°å½•ä½“é‡
   - æ¯æœˆæé†’ç”¨æˆ·æµ‹é‡ä½“è„‚ç‡
   - æ¯å­£åº¦æé†’å®¡æŸ¥è®­ç»ƒæ°´å¹³å’Œæ´»åŠ¨æ°´å¹³

2. **è¶‹åŠ¿åˆ†æ**
   - ä½“é‡å˜åŒ–æ›²çº¿å›¾
   - ä½“è„‚ç‡å˜åŒ–è¶‹åŠ¿
   - ç˜¦ä½“é‡å¢é•¿è¿½è¸ª

3. **æ™ºèƒ½å»ºè®®**
   - åŸºäº 1RM è¿›æ­¥è‡ªåŠ¨å»ºè®®å‡çº§è®­ç»ƒæ°´å¹³
   - åŸºäºå®é™…è®­ç»ƒé¢‘ç‡å»ºè®®è°ƒæ•´æ´»åŠ¨æ°´å¹³

### Phase 3: é«˜çº§ä¼˜åŒ–

1. **å®Œå…¨åˆ†ç¦»é™æ€å’ŒåŠ¨æ€æ•°æ®**
   - è¿ç§»åˆ°æ¨èçš„æ•°æ®æ¨¡å‹
   - åˆ›å»ºç‹¬ç«‹çš„ body_compositions é›†åˆ

2. **æ•°æ®ç‰ˆæœ¬æ§åˆ¶**
   - è®°å½•æ¯æ¬¡ä¿®æ”¹çš„å†å²
   - æ”¯æŒæ•°æ®å›æ»š

---

## ç”¨æˆ·ç•Œé¢å»ºè®®

### 1. è®¾ç½®é¡µé¢åˆ†åŒº

```
ç”¨æˆ·è®¾ç½®
â”œâ”€â”€ åŸºç¡€ä¿¡æ¯ï¼ˆå‡ ä¹ä¸å¯ç¼–è¾‘ï¼‰
â”‚   â”œâ”€â”€ æ€§åˆ« âš ï¸ ä¿®æ”¹éœ€ç¡®è®¤
â”‚   â”œâ”€â”€ å‡ºç”Ÿæ—¥æœŸ ğŸ”’ ä¸å¯ä¿®æ”¹ï¼ˆæˆ–éœ€ç®¡ç†å‘˜ï¼‰
â”‚   â””â”€â”€ èº«é«˜ âœï¸ å¯ç¼–è¾‘
â”‚
â”œâ”€â”€ å½“å‰çŠ¶æ€ï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰
â”‚   â”œâ”€â”€ å½“å‰å¹´é¾„ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
â”‚   â”œâ”€â”€ å½“å‰ä½“é‡ + [æ›´æ–°] æŒ‰é’®
â”‚   â”œâ”€â”€ å½“å‰ä½“è„‚ç‡ + [æ›´æ–°] æŒ‰é’®
â”‚   â””â”€â”€ å½“å‰ç˜¦ä½“é‡ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼Œç°è‰²æ˜¾ç¤ºï¼‰
â”‚
â”œâ”€â”€ è®­ç»ƒä¿¡æ¯ï¼ˆå®šæœŸå®¡æŸ¥ï¼‰
â”‚   â”œâ”€â”€ è®­ç»ƒæ°´å¹³ + ğŸ’¡ å»ºè®®å‡çº§æç¤º
â”‚   â”œâ”€â”€ æ´»åŠ¨æ°´å¹³
â”‚   â”œâ”€â”€ è®­ç»ƒå¼€å§‹æ—¥æœŸ ğŸ”’ ä¸å¯ä¿®æ”¹
â”‚   â””â”€â”€ è®­ç»ƒå¹´é™ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
â”‚
â””â”€â”€ å†å²è®°å½•ï¼ˆåªè¯»ï¼Œå›¾è¡¨å±•ç¤ºï¼‰
    â”œâ”€â”€ ä½“é‡å†å²æ›²çº¿
    â”œâ”€â”€ ä½“è„‚ç‡å†å²
    â””â”€â”€ ç˜¦ä½“é‡å˜åŒ–è¶‹åŠ¿
```

### 2. å¿«é€Ÿæ›´æ–°å…¥å£

åœ¨ Dashboard æ˜¾è‘—ä½ç½®æ·»åŠ ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ä»Šæ—¥èº«ä½“æ•°æ®                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä½“é‡: 70.5 kg                    â”‚
â”‚ ä¸Šæ¬¡è®°å½•: 7å¤©å‰ âš ï¸               â”‚
â”‚ [+ è®°å½•ä»Šæ—¥ä½“é‡]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®ä¸€è‡´æ€§è§„åˆ™

### 1. è‡ªåŠ¨è®¡ç®—å­—æ®µ

è¿™äº›å­—æ®µ**æ°¸è¿œä¸åº”è¯¥æ‰‹åŠ¨è¾“å…¥**ï¼Œå¿…é¡»è‡ªåŠ¨è®¡ç®—ï¼š

```typescript
// âœ… æ­£ç¡®ï¼šè‡ªåŠ¨è®¡ç®—
age = calculateAge(dateOfBirth);
leanBodyMass = weight - (weight * bodyFatPercentage / 100);
trainingYears = (Date.now() - firstTrainingDate) / (365.25 * 24 * 60 * 60 * 1000);

// âŒ é”™è¯¯ï¼šå…è®¸ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥è¿™äº›è®¡ç®—å­—æ®µ
```

### 2. æ•°æ®æ ¡éªŒ

```typescript
// ä½“é‡æ›´æ–°æ—¶ï¼Œé‡æ–°è®¡ç®—ç˜¦ä½“é‡
async function updateWeight(userId: string, newWeight: number) {
  const user = await User.findById(userId);

  // æ›´æ–°å½“å‰ä½“é‡
  user.fitnessProfile.weight = newWeight;

  // é‡æ–°è®¡ç®—ç˜¦ä½“é‡
  if (user.fitnessProfile.bodyFatPercentage) {
    user.fitnessProfile.leanBodyMass =
      newWeight - (newWeight * user.fitnessProfile.bodyFatPercentage / 100);
  }

  await user.save();

  // ä¿å­˜å†å²è®°å½•
  await WeightHistory.create({
    userId: user._id,
    weight: newWeight,
    measuredAt: new Date()
  });
}
```

### 3. çº§è”æ›´æ–°

```typescript
// ä½“è„‚ç‡æ›´æ–°æ—¶ï¼Œå¿…é¡»åŒæ—¶æ›´æ–°ç˜¦ä½“é‡
async function updateBodyFat(userId: string, newBodyFat: number) {
  const user = await User.findById(userId);

  user.fitnessProfile.bodyFatPercentage = newBodyFat;

  // âš ï¸ å…³é”®ï¼šçº§è”æ›´æ–°ç˜¦ä½“é‡
  user.fitnessProfile.leanBodyMass =
    user.fitnessProfile.weight - (user.fitnessProfile.weight * newBodyFat / 100);

  await user.save();
}
```

---

## æ€»ç»“

### ğŸ”’ å®Œå…¨ä¸å¯å˜ï¼ˆ1 ä¸ªï¼‰
- **gender** - æ€§åˆ«

### âš ï¸ å‡ ä¹ä¸å¯å˜ï¼ˆ2 ä¸ªï¼‰
- **dateOfBirth** - å‡ºç”Ÿæ—¥æœŸ
- **height** - èº«é«˜ï¼ˆæˆå¹´äººï¼‰

### ğŸ”„ æ…¢å˜åŒ–ï¼ˆ3 ä¸ªï¼‰
- **trainingLevel** - è®­ç»ƒæ°´å¹³ï¼ˆ3-6ä¸ªæœˆï¼‰
- **activityLevel** - æ´»åŠ¨æ°´å¹³ï¼ˆ1-3ä¸ªæœˆï¼‰
- **trainingYears** - è®­ç»ƒå¹´é™ï¼ˆçº¿æ€§å¢é•¿ï¼Œå»ºè®®è‡ªåŠ¨è®¡ç®—ï¼‰

### ğŸ“Š å¿«å˜åŒ–ï¼ˆ3 ä¸ªï¼‰
- **weight** - ä½“é‡ï¼ˆæ¯å‘¨ï¼Œéœ€è¦å†å²è®°å½•ï¼‰
- **bodyFatPercentage** - ä½“è„‚ç‡ï¼ˆæ¯æœˆï¼Œéœ€è¦å†å²è®°å½•ï¼‰
- **leanBodyMass** - ç˜¦ä½“é‡ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼Œè·Ÿéšä½“é‡å’Œä½“è„‚å˜åŒ–ï¼‰

### âš™ï¸ è‡ªåŠ¨è®¡ç®—ï¼ˆ2 ä¸ªï¼‰
- **age** - å¹´é¾„ï¼ˆä» dateOfBirth è‡ªåŠ¨è®¡ç®—ï¼‰
- **leanBodyMass** - ç˜¦ä½“é‡ï¼ˆä» weight å’Œ bodyFatPercentage è®¡ç®—ï¼‰

---

**å…³é”®å»ºè®®**:
1. âœ… ç«‹å³ä¿®å¤ï¼šä½¿ç”¨ `dateOfBirth` æ›¿ä»£ `age`
2. âœ… ç«‹å³æ·»åŠ ï¼š`firstTrainingDate` ç”¨äºè‡ªåŠ¨è®¡ç®— `trainingYears`
3. âœ… æœªæ¥ä¼˜åŒ–ï¼šä¸º `weight` å’Œ `bodyFatPercentage` åˆ›å»ºå†å²è®°å½•è¡¨
4. âœ… UI è®¾è®¡ï¼šæ˜ç¡®åŒºåˆ†ä¸å¯å˜ã€æ…¢å˜åŒ–ã€å¿«å˜åŒ–å­—æ®µçš„ç¼–è¾‘æƒé™

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-02
**çŠ¶æ€**: âœ… å®Œæˆåˆ†æ
